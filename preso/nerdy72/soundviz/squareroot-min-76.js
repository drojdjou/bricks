/*

Squareroot.js
A micro 3d engine for HTML5

Version 1.2
Build 76 | Mon Feb 17 17:58:05 2014

Contains requestAnimFrame.js by Paul Irish
http://paulirish.com/2011/requestanimationframe-for-smart-animating/

*/
window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1E3/60)}}();var SQR=function(){if(typeof window.Float32Array=="undefined")window.Float32Array=window.Array;return{DYNAMIC_TRANSFORM:0,STATIC_TRANSFORM:1,twoPI:Math.PI*2,halfPI:Math.PI*0.5,deg2rad:Math.PI/180,rad2deg:180/Math.PI,supportsCss3d:!1,usePreserve3d:!1}}();SQR.BUILD=76;SQR.Squareroot=function(a,c){var b={},d;b.projection=new SQR.ProjectionMatrix;this.lightDirection=(new SQR.V3(1,-1,0)).norm();var e=!0;this.setSorting=function(a){e=a};this.setBackground=function(b){if(a)d=a.style.backgroundColor=b;if(c)c.style.backgroundColor=b};this.setProjection=function(a){b.cssDistance=0.5/Math.tan(a*Math.PI/360)*b.height;b.projection.perspective(a,b.width/b.height,0.1,1E3);if(c)c.style.perspective=b.cssDistance+"px",c.style["-webkit-perspective"]=b.cssDistance+"px",c.style["-moz-perspective"]=
b.cssDistance+"px",c.style["-o-perspective"]=b.cssDistance+"px"};this.cssDistance=function(){return b.cssDistance};this.setSize=function(c,d){b.width=c;b.height=d;if(a)a.width=c,a.height=d;b.aspect=c/d;b.centerX=c*0.5;b.centerY=d*0.5};this.children=[];this.numChildren=0;var f=[];this.add=function(){for(var a=0;a<arguments.length;a++){var b=arguments[a];b.parent=null;this.children.indexOf(b)==-1&&this.children.push(b)}this.numChildren=this.children.length};this.remove=function(){for(var a=0;a<arguments.length;a++){var b=
arguments[a],c=this.children.indexOf(b);if(c==-1)return!1;b.parent=null;b.renderer&&(b.renderer.isDom2d||b.renderer.isDom3d)&&b.renderer.removeFromDom();this.children.splice(c,1)}this.numChildren=this.children.length};this.contains=function(a){return this.children.indexOf(a)>-1};this.recurse=function(a){for(var b=0;b<this.numChildren;b++)this.children[b].recurse(a)};this.removeAll=function(){for(var a=0;a<this.numChildren;a++){var b=this.children[a];b.parent=null;b.renderer&&(b.renderer.isDom2d||
b.renderer.isDom3d)&&b.renderer.removeFromDom()}this.children=[];this.numChildren=this.children.length};var g=function(a){a.renderer&&(a.renderer.isDom3d&&SQR.usePreserve3d&&a.parent&&a.parent.renderer&&a.parent.renderer.isDom3d?a.renderer.appendToDom(a.parent.renderer.element):(a.renderer.isDom2d||a.renderer.isDom3d)&&a.renderer.appendToDom(c));a.transformWorld();f.push(a);if(a.numChildren>0)for(var b=0;b<a.numChildren;b++)g(a.children[b])};this.render=function(c){SQR.Time.tick();var i;f.length=
0;if(b.context&&(b.context.setTransform(1,0,0,1,0,0),b.context.clearRect(0,0,a.width,a.height),d))b.context.fillStyle=d,b.context.fillRect(0,0,a.width,a.height);for(i=0;i<this.numChildren;i++)g(this.children[i]);var j=f.length;b.camera=c;b.viewMatrix=c.computeInverseMatrix();b.lightDirection=this.lightDirection;for(i=0;i<j;i++)c=f[i],c.transformView(b.viewMatrix);e&&f.sort(function(a,b){var c=a.depth(),d=b.depth();if(c<d)return-1;if(c>d)return 1;return 0});for(i=0;i<j;i++)if(c=f[i],c.enabled){if(c.renderer)b.depth=
i,c.renderer.draw(c,b);c.collider&&c.collider.project(c,b)}};if(a)b.context=a.getContext("2d"),this.setSize(a.width,a.height);if(c)c.style.webkitTransformStyle="preserve-3d",c.style.transformStyle="preserve-3d";b.projection.identity();b.container=c};SQR.SquarerootGL=function(a){var c={},b=a.getContext(SQR.GL.contextString),d,e;SQR.GL.init(b);this.setClearColor=function(a,c,d,f){e=[a,c,d,f];b.clearColor(a,c,d,f)};this.setProjection=function(a){c.projection=a};this.setSize=function(){a.width=window.innerWidth;a.height=window.innerHeight};this.createTexture=function(a,c){return new SQR.Texture(b,a,c)};this.createCubemap=function(a,c){return new SQR.Cubemap(b,a,c)};this.createShader=function(){return new SQR.Shader(b)};this.createRenderer=function(a){return new SQR.WebGL(b,
a)};this.createFrameBuffer=function(a,c){return new SQR.FrameBuffer(b,a||window.innerWidth,c||window.innerHeight)};var f=[],g=[],h=function(a){a.transformWorld();a.renderer&&a.enabled&&(a.renderer.transparent?g.push(a):f.push(a));if(a.numChildren>0)for(var b=0;b<a.numChildren;b++)h(a.children[b])};this.clear=function(c){if(c.region){var f=c.region;b.viewport(f.x,f.y,f.w,f.h);b.scissor(f.x,f.y,f.w,f.h);b.enable(b.SCISSOR_TEST)}else b.viewport(0,0,a.width,a.height),b.disable(b.SCISSOR_TEST);if(!c.target||
d&&d!=c.target)b.bindFramebuffer(b.FRAMEBUFFER,null),d=null;if(c.target)d=c.target,b.bindFramebuffer(b.FRAMEBUFFER,c.target.fbo);if(c.clearColor)f=c.clearColor,b.clearColor(f[0],f[1],f[2],f[3]);c.dontClear||b.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT);c.culling?b.enable(b.CULL_FACE):b.disable(b.CULL_FACE);c.reverseFace?b.frontFace(b.CCW):b.frontFace(b.CW);c.clearColor&&(f=e,this.setClearColor(f[0],f[1],f[2],f[3]))};var i={region:null,dontClear:!1,culling:!0,reverseFace:!1};this.render=function(a,
d,e){e=e||i;this.clear(e);f.length=0;g.length=0;h(a);if(d)c.camera=d,c.viewMatrix=d.computeInverseMatrix();c.replacementShader=e.replacementShader||null;d=f.length;b.enable(b.DEPTH_TEST);b.disable(b.BLEND);for(a=0;a<d;a++)e=f[a],e.renderer.draw(e,c);d=g.length;if(d!=0){b.enable(b.BLEND);for(a=0;a<d;a++){e=g[a];var l=e.renderer.srcFactor!=null?e.renderer.srcFactor:b.SRC_ALPHA,m=e.renderer.dstFactor!=null?e.renderer.dstFactor:b.ONE;e.renderer.depthTest?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST);
b.blendFunc(l,m);e.renderer.draw(e,c)}}}};SQR.Transform=function(a){this.name=a;this.enabled=!0;this.useQuaternion=this.directMatrixMode=!1;this.engine=this.parent=this.collider=this.geometry=this.renderer=null;this.position=new SQR.V3;this.rotation=new SQR.V3;this.rotationQ=new SQR.Quaternion;this.scale=new SQR.V3(1,1,1);var c=new SQR.V3;this.matrix=new SQR.Matrix44;this.globalMatrix=new SQR.Matrix44;this.viewMatrix=new SQR.Matrix44;this.normalMatrix=new SQR.Matrix33;this.inverseWorldMatrix=new SQR.Matrix44;this.forward=new SQR.V3;this.left=
new SQR.V3;this.top=new SQR.V3;this.positioningMode=0;this.depth=function(){return this.viewMatrix.data[14]};this.children=[];this.numChildren=0;this.add=function(){for(var a=0;a<arguments.length;a++){var c=arguments[a];c.parent=this;this.children.indexOf(c)==-1&&this.children.push(c)}this.numChildren=this.children.length};this.remove=function(){for(var a=0;a<arguments.length;a++){var c=arguments[a],e=this.children.indexOf(c);if(e==-1)return!1;c.parent=null;c.renderer&&(c.renderer.isDom2d||c.renderer.isDom3d)&&
c.renderer.removeFromDom();this.children.splice(e,1)}this.numChildren=this.children.length};this.contains=function(a){return this.children.indexOf(a)>-1};this.recurse=function(a){a(this);for(var c=0;c<this.numChildren;c++)this.children[c].recurse(a)};this.removeAll=function(){for(var a=0;a<this.numChildren;a++){var c=this.children[a];c.parent=null;c.renderer&&(c.renderer.isDom2d||c.renderer.isDom3d)&&c.renderer.removeFromDom()}this.children=[];this.numChildren=this.children.length};this.transformWorld=
function(){if(this.positioningMode!=2){if(!this.directMatrixMode){var a=this.position,d=this.rotationQ,e=this.rotation,f=this.scale;this.useQuaternion?this.matrix.setTQS(a.x,a.y,a.z,d.w,d.x,d.y,d.z,f.x,f.y,f.z):this.matrix.setTRS(a.x,a.y,a.z,e.x,e.y,e.z,f.x,f.y,f.z)}this.lookDirection&&(this.matrix.lookAt(this.lookDirection,SQR.V3.up),this.matrix.scale(f.x,f.y,f.z));this.parent?(this.parent.globalMatrix.copyTo(this.globalMatrix),this.globalMatrix.multiply(this.matrix)):this.matrix.copyTo(this.globalMatrix);
this.lookTarget&&this.globalMatrix.lookAt(this.lookTarget.globalPosition(),SQR.V3.up);this.globalMatrix.extractPosition(c);this.globalMatrix.inverseMat3(this.normalMatrix);a=this.normalMatrix.data;this.left.set(a[0],a[3],a[6]);this.top.set(a[1],a[4],a[7]);this.forward.set(a[2],a[5],a[8]);if(this.positioningMode==1)this.positioningMode=2}};this.globalPosition=function(){return c};this.transformView=function(a){a.copyTo(this.viewMatrix);this.viewMatrix.multiply(this.globalMatrix)};this.lookAt=function(a){this.lookTarget=
a};this.lookInDirection=function(a){this.lookDirection=a};this.computeInverseMatrix=function(){this.globalMatrix.inverse(this.inverseWorldMatrix);return this.inverseWorldMatrix}};SQR.Cube=function(a){a=a||{};a.offset=a.offset||new SQR.V3;var c=[],b=[],d=[],e=[],f=(new SQR.Geometry).quickSetup("v3n3t2");f.corners={};var g=function(b,d,e,f,g,l){var m=new SQR.Triangle(a);a.skybox?m.setVertices(b,e,d):m.setVertices(b,d,e);m.setAttribute(SQR.Geometry.TEXCOORD,f,g,l);c.push(m)};f.create=function(b,c,d){c=c||b;d=d||b;var e=a.offset,n=(new SQR.V3(b*-0.5,c*0.5,d*0.5)).appendVec(e),l=(new SQR.V3(b*0.5,c*0.5,d*0.5)).appendVec(e),m=(new SQR.V3(b*-0.5,c*-0.5,d*0.5)).appendVec(e),o=(new SQR.V3(b*
0.5,c*-0.5,d*0.5)).appendVec(e),p=(new SQR.V3(b*-0.5,c*0.5,d*-0.5)).appendVec(e),s=(new SQR.V3(b*0.5,c*0.5,d*-0.5)).appendVec(e),q=(new SQR.V3(b*-0.5,c*-0.5,d*-0.5)).appendVec(e);b=(new SQR.V3(b*0.5,c*-0.5,d*-0.5)).appendVec(e);c=new SQR.V2(0,0);d=new SQR.V2(1,0);e=new SQR.V2(0,1);var r=new SQR.V2(1,1);f.corners.ftl=n;f.corners.ftr=l;f.corners.fbl=m;f.corners.fbr=o;f.corners.btl=p;f.corners.btr=s;f.corners.bbl=q;f.corners.bbr=b;g(n,l,o,e,r,d);g(n,o,m,e,d,c);g(p,b,s,r,c,e);g(p,q,b,r,d,c);g(n,m,p,r,
d,e);g(m,q,p,d,c,e);g(l,s,o,e,r,c);g(o,s,b,c,r,d);g(n,p,l,c,e,d);g(p,s,l,e,r,d);g(m,o,q,e,r,c);g(q,o,b,c,r,d);return f.refresh()};f.refresh=function(){var a=c.length;b.length=0;d.length=0;for(var g=e.length=0;g<a;g++)c[g].calculateNormal();for(g=0;g<a;g++)c[g].toArray(SQR.Geometry.VERTEX,b),c[g].toArray(SQR.Geometry.NORMAL,d),c[g].toArray(SQR.Geometry.TEXCOORD,e);f.data(SQR.Geometry.VERTEX,b);f.data(SQR.Geometry.NORMAL,d);f.data(SQR.Geometry.TEXCOORD,e);return f};return f};SQR.Cylinder=function(a){a=a||{};var c,b,d,e,f,g,h=[],i=[],j=[],k=[],n=(new SQR.Geometry).quickSetup("v3n3t2"),l=function(b,c,d,e,f,g){var j=new SQR.Triangle(a);j.setVertices(b,c,d);j.setAttribute(SQR.Geometry.TEXCOORD,e,f,g);h.push(j)};n.create=function(h,j,i){c=[];b=[];d=[];e=[];for(var k=0;k<i;k++){var q=new SQR.V3,r=new SQR.V3,u=new SQR.V2,t=new SQR.V2,v=Math.cos(k/i*SQR.twoPI)*j,w=Math.sin(k/i*SQR.twoPI)*j;a.vertical?(q.set(w,h*-0.5,v),r.set(w,h*0.5,v)):(q.set(h*-0.5,v,w),r.set(h*0.5,v,w));u.set(k/
i,0);t.set(k/i,1);a.noCaps||(a.vertical?(f=new SQR.V3(0,h*-0.5,0),g=new SQR.V3(0,h*0.5,0)):(f=new SQR.V3(h*-0.5,0,0),g=new SQR.V3(h*0.5,0,0)));c.push(q);b.push(r);d.push(u);e.push(t);if(a.insideFaces)q._inside=q.clone(),r._inside=r.clone()}for(k=0;k<i;k++)h=c[k],j=b[k],q=d[k],r=e[k],w=(k+1)%i,u=c[w],t=b[w],v=d[w],w=e[w],l(h,j,u,q,r,v),l(u,j,t,v,r,w),a.noCaps?a.insideFaces&&(l(h._inside,u._inside,j._inside,q,r,v),l(u._inside,t._inside,j._inside,v,r,w)):(l(h,u,f,q,r,v),l(t,j,g,v,r,w));return n.refresh()};
n.refresh=function(){var a=h.length;i.length=0;j.length=0;for(var b=k.length=0;b<a;b++)h[b].calculateNormal();for(b=0;b<a;b++)h[b].toArray(SQR.Geometry.VERTEX,i),h[b].toArray(SQR.Geometry.NORMAL,j),h[b].toArray(SQR.Geometry.TEXCOORD,k);n.data(SQR.Geometry.VERTEX,i);n.data(SQR.Geometry.NORMAL,j);n.data(SQR.Geometry.TEXCOORD,k);return n};return n};SQR.Geometry=function(){var a={},c=this;this.count=0;this.dirty=!1;this.attr=function(){for(var b=arguments.length,d=0;d<b;d+=2)a[arguments[d]]={size:arguments[d+1]};return c};this.data=function(){for(var b=arguments.length,d,e=0;e<b;e+=2){var f=arguments[e],g=arguments[e+1],h=a[f];h?(d=g.length/h.size,!h.data||c.count==0||d!=c.count||g.length!=h.data.length?h.data=new Float32Array(g):h.data.set(g)):console.warn("Trying to add attribute that was not setup for this geometry: "+f)}c.count=d;c.dirty=
!0;return c};this.quickSetup=function(a){for(var d=a.split(""),e=0;e<d.length;e+=2){var f=d[e];a=parseInt(d[e+1]);if(isNaN(a))throw"Forgot to add sizes when creating geometry -> "+a;switch(f){case "v":c.attr(SQR.Geometry.VERTEX,a);break;case "n":c.attr(SQR.Geometry.NORMAL,a);break;case "c":c.attr(SQR.Geometry.COLOR,a);break;case "t":c.attr(SQR.Geometry.TEXCOORD,a);break;case "u":c.attr(SQR.Geometry.TEXCOORD2,a)}}return c};this.setupBuffers=function(b,c,e){for(var f=0;f<c.numAttributes;f++){var g=
c.attributes[f],h=a[g.name];if(!h)throw"Attribute required by shader not found on geometry: "+g.name;if(!h.buffer)h.buffer=b.createBuffer();b.bindBuffer(b.ARRAY_BUFFER,h.buffer);b.bufferData(b.ARRAY_BUFFER,h.data,e);b.enableVertexAttribArray(g.location);b.vertexAttribPointer(g.location,h.size,b.FLOAT,!1,0,0)}}};SQR.Geometry.VERTEX="aVertexPosition";SQR.Geometry.NORMAL="aVertexNormal";SQR.Geometry.TEXCOORD="aTextureCoord";SQR.Geometry.TEXCOORD2="aTextureCoord2";SQR.Geometry.COLOR="aVertexColor";SQR.Icosphere=function(a){var c=[],b=[],d=[],e=[],f=[],g=[],h=[],i=0,j=(new SQR.Geometry).quickSetup("v3n3c4t2"),k;a=a||{};var n=[[1,0,0,1],[0,1,0,2],[0,0,1,3],[1,1,0,4],[0,1,1,5]],l=new SQR.V3;new SQR.V3(0,1,0);new SQR.V3(0,0,1);var m=function(a){l.copyFrom(a);l.norm();return new SQR.V2(1-(0.5+Math.atan2(l.z,l.x)/SQR.twoPI),1-(0.5-Math.asin(l.y)/Math.PI))},o=function(b,d,e,f,g,h){var j=new SQR.Triangle(a);j.setVertices(b,d,e);j.setAttribute(SQR.Geometry.COLOR,f,g,h);b=m(b);d=m(d);e=m(e);g=Math.abs(b.x-
d.x);h=Math.abs(d.x-e.x);f=Math.abs(e.x-b.x);if(g+h+f>0.8&&(b.x>=0.8&&(b.x-=1),d.x>=0.8&&(d.x-=1),e.x>=0.8&&(e.x-=1),g=Math.abs(b.x-d.x),h=Math.abs(d.x-e.x),f=Math.abs(e.x-b.x),g+h+f>0.5)){if(b.x>=0.5)b.x=0;if(d.x>=0.5)d.x=0;if(e.x>=0.5)e.x=0}j.setAttribute(SQR.Geometry.TEXCOORD,b,d,e);c.push(j)};j.create=function(a){k=a;var c=(1+Math.sqrt(5))*0.5*a,d=function(a,c,d){b.push((new SQR.V3(a,c,d)).norm().mul(k))},e=function(a,c,d){var e=n[0];o(b[a],b[d],b[c],e,e,e)};d(-a,c,0);d(a,c,0);d(-a,-c,0);d(a,
-c,0);d(0,-a,c);d(0,a,c);d(0,-a,-c);d(0,a,-c);d(c,0,-a);d(c,0,a);d(-c,0,-a);d(-c,0,a);e(0,11,5);e(0,5,1);e(0,1,7);e(0,7,10);e(0,10,11);e(1,5,9);e(5,11,4);e(11,10,2);e(10,7,6);e(7,1,8);e(3,9,4);e(3,4,2);e(3,2,6);e(3,6,8);e(3,8,9);e(4,9,5);e(2,4,11);e(6,2,10);e(8,6,7);e(9,8,1);return j.refresh()};var p=function(a,c){for(var d=b.length,e=0;e<d;e++){var f=b[e],g=f.__v2==a&&f.__v1==c;if(f.__v1==a&&f.__v2==c||g)return f}d=new SQR.V3;d.sub(a,c).mul(0.5).appendVec(c).norm().mul(k);d.__v1=a;d.__v2=c;b.push(d);
return d};j.subdivide=function(){h[i]={};var a=h[i];a.faces=c;a.vectors=b;c=[];for(var d=a.faces.length,e=0;e<d;e++){var f=a.faces[e].data(SQR.Geometry.VERTEX),g=a.faces[e].data(SQR.Geometry.COLOR),l=p(f.a,f.b),k=p(f.a,f.c),m=p(f.b,f.c),y=n[i+1];o(f.a,l,k,g.a,y,y);o(f.b,m,l,g.b,y,y);o(f.c,k,m,g.c,y,y);o(l,m,k,y,y,y)}i++;j.refresh();return j};j.refresh=function(){var b=c.length;d.length=0;e.length=0;f.length=0;g.length=0;var h,i;for(h=0;h<b;h++)c[h].calculateNormal(a.perVertexNormals);for(h=0;h<b;h++)i=
c[h],i.toArray(SQR.Geometry.VERTEX,d),i.toArray(SQR.Geometry.NORMAL,e),i.toArray(SQR.Geometry.COLOR,f),i.toArray(SQR.Geometry.TEXCOORD,g);j.data(SQR.Geometry.VERTEX,d);j.data(SQR.Geometry.NORMAL,e);j.data(SQR.Geometry.COLOR,f);j.data(SQR.Geometry.TEXCOORD,g);return j};j.vectors=b;j.cache=h;return j};SQR.Mesh=function(a,c){var b=this;SQR.Loader.loadText(a,function(d){switch(a.split(".").pop().toLowerCase()){case "obj":SQR.OBJParser.parse(d,b);break;default:throw"";}b.dirty=!0;b.vertexSize=3;b.numVertices=b.vertices.length/b.vertexSize;c&&c()})};SQR.Plane=function(a){var c=[],b=[],d=[],e=[],f=[],g=(new SQR.Geometry).quickSetup("v3n3t2");a=a||{};g.create=function(d,e,f,k,n,l){g.width=d;g.height=e;d*=0.5;e*=0.5;f=f||1;k=k||1;b.length=[];var m=-d+(n||0),o=-e+(l||0),p=g.width/f,s=g.height/k;d=[];n=[];for(e=0;e<f+1;e++){d[e]=[];n[e]=[];for(l=0;l<k+1;l++){var q=m+e*p,r=o+l*s;n[e][l]=new SQR.V2(e/f,l/k);d[e][l]=a.zUp?new SQR.V3(q,r,0):new SQR.V3(q,0,r);c.push(d[e][l])}}for(e=0;e<f;e++)for(l=0;l<k;l++){m=d[e][l];var u=d[e+1][l];o=d[e+1][l+1];p=d[e][l+
1];s=n[e][l];var t=n[e+1][l];q=n[e+1][l+1];r=n[e][l+1];if(a.quads)m=(new SQR.Quad(m,u,o,p)).setUV(s,t,q,r),b.push(m);else{var v=new SQR.Triangle;v.setVertices(m,u,o);v.setAttribute(SQR.Geometry.TEXCOORD,s,t,q);u=new SQR.Triangle;u.setVertices(m,o,p);u.setAttribute(SQR.Geometry.TEXCOORD,s,q,r);b.push(v,u)}}return g.refresh()};g.displaceVertices=function(a){for(var b=c.length,d=0;d<b;d++)a(c[d]);return g.refresh()};g.refresh=function(){var c=b.length;d.length=0;e.length=0;for(var i=f.length=0;i<c;i++)b[i].calculateNormal(a.perVertextNormals);
for(i=0;i<c;i++)b[i].toArray(SQR.Geometry.VERTEX,d),b[i].toArray(SQR.Geometry.NORMAL,e),b[i].toArray(SQR.Geometry.TEXCOORD,f);g.data(SQR.Geometry.VERTEX,d);g.data(SQR.Geometry.NORMAL,e);g.data(SQR.Geometry.TEXCOORD,f);return g};return g};SQR.Pyramid=function(a){a=a||{};a.offset=a.offset||new SQR.V3;var c=[],b=[],d=[],e=(new SQR.Geometry).quickSetup("v3n3");e.create=function(b,d,h,i,j){var k=b||1;i=i||4;h=h||0;d=new SQR.V3(0,d||5,0);h=new SQR.V3(0,-h,0);new SQR.V2(0.5,1);b=[];var n;j=j||Math.PI*0.25;for(n=0;n<i;n++)b.push(new SQR.V3(Math.cos(n/i*SQR.twoPI+j)*k,0,Math.sin(n/i*SQR.twoPI+j)*k));for(n=0;n<i;n++){var l=n+1;l>=i&&(l=0);j=d;k=b[n];l=b[l];var m=new SQR.Triangle(a);m.setVertices(j,k,l);m.setAttribute(SQR.Geometry.TEXCOORD,
void 0,void 0,void 0);c.push(m)}if(!a.noCap)for(n=0;n<i;n++)l=n+1,l>=i&&(l=0),j=h,k=b[l],l=b[n],m=new SQR.Triangle(a),m.setVertices(j,k,l),m.setAttribute(SQR.Geometry.TEXCOORD,void 0,void 0,void 0),c.push(m);e.peak=d;e.base=b;e.bottom=h;return e.refresh()};e.refresh=function(){for(var a=c.length,g=0;g<a;g++)c[g].calculateNormal();b.length=0;for(g=d.length=0;g<a;g++)c[g].toArray(SQR.Geometry.VERTEX,b),c[g].toArray(SQR.Geometry.NORMAL,d);e.data(SQR.Geometry.VERTEX,b);e.data(SQR.Geometry.NORMAL,d);return e};
return e};SQR.Quad=function(){this.size=4;var a=this,c,b,d=arguments;arguments.length==2?(c=d[0],b=d[1],this.vertices=[c.a,c.b,c.c,b.a,b.b,b.c],console.warn("Creating quads out of 2 triangles is deprecated! Pass 4 vertices instead")):(c=new SQR.Triangle(d[0],d[1],d[2]),b=new SQR.Triangle(d[0],d[2],d[3]),this.vertices=[d[0],d[1],d[2],d[3]]);this.normal=c.a.clone();var e=!1;this.calculateNormal=function(d){e=d;c.calculateNormal(d);b.calculateNormal(d);a.normal.add(c.normal,b.normal).norm()};this.toArray=function(d,
g,h){if(e)c.toArray(d,g,h),b.toArray(d,g,h);else if(c.toArray(d,null,h),b.toArray(d,null,h),g){d=a.normal;for(h=6;h-- >0;)g.push(d.x,d.y,d.z)}}};SQR.Sprite2D=function(a,c){this.vertexSize=2;this.numVertices=6;this.dirty=!0;this.width=a;this.height=c;var b=new Float32Array(12),d=this.width,e=this.height;b[0]=d*-0.5;b[1]=e*0.5;b[2]=d*0.5;b[3]=e*-0.5;b[4]=d*0.5;b[5]=e*0.5;b[6]=d*-0.5;b[7]=e*0.5;b[8]=d*-0.5;b[9]=e*-0.5;b[10]=d*0.5;b[11]=e*-0.5;this.vertices=b};SQR.Sprite3D=function(){var a=this,c=2;this.vertexSize=3;this.numVertices=6;this.corners={};var b=[],d=[];this.biFaced=function(){c=4;a.numVertices=12;return a};this.setSize=function(d,f){b.length=0;var g=new SQR.V3(d*-0.5,f*0.5,0),h=new SQR.V3(d*0.5,f*0.5,0),i=new SQR.V3(d*-0.5,f*-0.5,0),j=new SQR.V3(d*0.5,f*-0.5,0);a.corners.tl=g;a.corners.tr=h;a.corners.bl=i;a.corners.br=j;b.push(new SQR.Triangle(g,h,j));b.push(new SQR.Triangle(g,j,i));c==4&&(b.push(new SQR.Triangle(g,j,h)),b.push(new SQR.Triangle(g,
i,j)));a.refresh();return a};this.refresh=function(){for(var e=d.length=0;e<c;e++)b[e].toArray(d);a.vertices=new Float32Array(d);a.dirty=!0;return a}};SQR.Triangle=function(){this.size=3;var a={},c=new SQR.V3;this.setVertices=function(a,b,c){this.setAttribute(SQR.Geometry.VERTEX,a,b,c)};this.setAttribute=function(b,c,f,g){a[b]={a:c,b:f,c:g}};this.data=function(b){return a[b]};this.setElements=function(){};this.setAttributeElements=function(){};this.calculateNormal=function(){var b=SQR.VectorUtil.__tv1,e=SQR.VectorUtil.__tv2,f=a[SQR.Geometry.VERTEX];b.sub(f.b,f.a);e.sub(f.c,f.a);c.cross(b,e).norm();this.setAttribute(SQR.Geometry.NORMAL,c,c,c)};this.reverseNormal=
function(){};var b=function(a,b){if(a)if(a.appendToArray)a.appendToArray(b);else if(a instanceof Array)b.push.apply(b,a);else if(isNaN(a*2))throw"Vertex attribute "+name+" has some invalid values: "+a;else b.push(a)};this.toArray=function(c,e){var f=a[c];if(!f)throw"Unknown attribute requested on triangle: "+c.toString();b(f.a,e);b(f.b,e);b(f.c,e)};this.toElements=function(){}};SQR.Tube=function(){var a=10,c=20,b=10,d=10,e=12,f=[],g=[],h=[],i=[],j=[],k,n,l=!1;this.vertexSize=3;this.inner=function(b){a=b;a==0&&(a=1.0E-4);return this};this.outer=function(a){c=a;return this};this.height=function(a,c){b=a;d=c||a;return this};this.resolution=function(a){e=a;return this};this.setDeformation=function(a){k=a;return this};this.smooth=function(a){l=a;return this};this.setTwist=function(a){n=a;return this};this.refresh=function(){var m;f.length=0;g.length=0;h.length=0;i.length=0;j.length=
0;var o=new SQR.Matrix44;for(m=0;m<e;m++){var p=m/e*Math.PI*2,s=b*0.5,q=d*0.5;k&&(s+=k(p,!0),q+=k(p,!1));var r=(c-a)*0.5,u=new SQR.V3(r,0,q),t=new SQR.V3(-r,0,s);q=new SQR.V3(r,0,-q);s=new SQR.V3(-r,0,-s);o.identity();o.rotate(0,0,p);o.translate(a+r,0,0);n&&n(o,p);o.transformVector(u);o.transformVector(t);o.transformVector(q);o.transformVector(s);f.push([u,u.clone()]);g.push([t,t.clone()]);h.push([q,q.clone()]);i.push([s,s.clone()])}for(m=0;m<e;m++){p=m+1;p==e&&(p=0);u=f[m];t=h[m];q=f[p];s=h[p];r=
g[m];o=i[m];var v=g[p];p=i[p];var w=new SQR.Triangle(u[0],t[0],s[0]),A=new SQR.Triangle(u[0],s[0],q[0]);j.push(new SQR.Quad(w,A));a>1.0E-4&&(w=new SQR.Triangle(r[0],p[0],o[0]),A=new SQR.Triangle(r[0],v[0],p[0]),j.push(new SQR.Quad(w,A)));q=new SQR.Triangle(u[1],q[1],v[1]);u=new SQR.Triangle(u[1],v[1],r[1]);j.push(new SQR.Quad(q,u));u=new SQR.Triangle(t[1],p[1],s[1]);t=new SQR.Triangle(t[1],o[1],p[1]);j.push(new SQR.Quad(u,t))}for(m=0;m<j.length;m++)j[m].calculateNormal(l);t=[];u=[];for(m=0;m<j.length;m++)j[m].toArray(t,
u);this.vertices=new Float32Array(t);this.normals=new Float32Array(u);this.numVertices=t.length/this.vertexSize;this.dirty=!0;return this}};SQR.Interpolation={bezierPosition:function(a,c,b,d,e){return c*(1-a)*(1-a)*(1-a)+b*3*a*(1-a)*(1-a)+d*3*a*a*(1-a)+e*a*a*a},bezierVelocity:function(a,c,b,d,e){return 3*b-3*c+2*(3*c-6*b+3*d)*a+3*(-c+3*b-3*d+e)*a*a},linear:function(a,c,b){if(b<=a)return a;if(b>=c)return c;return a+(c-a)*((b-a)/(c-a))},smoothStep:function(a,c,b){if(b<=a)return a;if(b>=c)return c;b=(b-a)/(c-a);return a+(c-a)*(3*b*b-2*b*b*b)},quadIn:function(a){return a*a},quadOut:function(a){return a*(2-a)},quadInOut:function(a){return(a*=
2)<1?0.5*a*a:-0.5*(--a*(a-2)-1)}};SQR.Mathx={clamp:function(a,c,b){if(a<c)return c;return a>b?b:a},clamp01:function(a){if(a<0)return 0;return a>1?1:a},step:function(a,c){return c>=a?1:0}};SQR.Matrix2D=function(){typeof Float32Array=="undefined"&&(Float32Array=Array);this.data=new Float32Array(9);var a,c,b,d,e;this.identity=function(a){a=a||this.data;a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return this};this.transformVector=function(a){b=this.data;d=a.x;e=a.y;a.x=b[0]*d+b[1]*e+b[2];a.y=b[3]*d+b[4]*e+b[5];return a};this.setTranslation=function(a,c,d){b=d||this.data;b[0]=1;b[1]=0;b[2]=a;b[3]=0;b[4]=1;b[5]=c;b[6]=0;b[7]=0;b[8]=1;return this};this.getTranslation=function(a){b=
this.data;a=a||new SQR.V2;a.x=b[2];a.y=b[5];return a};this.setScale=function(a,c,d){b=d||this.data;b[0]=a;b[1]=0;b[2]=0;b[3]=0;b[4]=c;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return this};this.setShear=function(a,c,d){b=d||this.data;b[0]=1;b[1]=a;b[2]=0;b[3]=c;b[4]=1;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return this};this.setRotation=function(a,c){b=c||this.data;var d=Math.cos(a),e=Math.sin(a);b[0]=d;b[1]=-e;b[2]=0;b[3]=e;b[4]=d;b[5]=0;b[6]=0;b[7]=0;b[8]=1;return this};this.setTRS=function(a,c,d,e,f){b=this.data;var g=
Math.cos(d);d=Math.sin(d);b[0]=g*e;b[1]=-d*f;b[2]=a;b[3]=d*e;b[4]=g*f;b[5]=c;b[6]=0;b[7]=0;b[8]=1;return this};this.translate=function(a,b){this.identity(SQR.Matrix2D.__temp);this.setTranslation(a,b,SQR.Matrix2D.__temp);return this.multiply(SQR.Matrix2D.__temp)};this.rotate=function(a){this.identity(SQR.Matrix2D.__temp);this.setRotation(a,SQR.Matrix2D.__temp);return this.multiply(SQR.Matrix2D.__temp)};this.scale=function(a,b){this.identity(SQR.Matrix2D.__temp);this.setScale(a,b,SQR.Matrix2D.__temp);
return this.multiply(SQR.Matrix2D.__temp)};this.shear=function(a,b){this.identity(SQR.Matrix2D.__temp);this.setRotation(a,b,SQR.Matrix2D.__temp);return this.multiply(SQR.Matrix2D.__temp)};var f,g,h,i,j,k,n,l,m,o,p,s,q,r,u;this.multiply=function(b){a=this.data;c=b.data||b;f=a[0];g=a[1];h=a[2];i=a[3];j=a[4];k=a[5];n=c[0];l=c[1];m=c[2];o=c[3];p=c[4];s=c[5];q=c[6];r=c[7];u=c[8];a[0]=f*n+g*o+h*q;a[1]=f*l+g*p+h*r;a[2]=f*m+g*s+h*u;a[3]=i*n+j*o+k*q;a[4]=i*l+j*p+k*r;a[5]=i*m+j*s+k*u;return this};this.copyTo=
function(b){a=this.data;c=b.data||b;c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return b};this.copyFrom=function(b){a=b.data||b;c=this.data;c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];return this};var t=function(a){return Math.abs(a)<1.0E-6?0:a};this.getAsCSSProperty=function(a){var b=this.data;return a?"matrix3d("+t(b[0])+","+t(b[3])+",0,0,"+t(b[1])+","+t(b[4])+",0,0,0,0,1,0,"+t(b[2])+","+t(b[5])+",0,1)":
"matrix("+t(b[0])+","+t(b[3])+","+t(b[1])+","+t(b[4])+","+t(b[2])+","+t(b[5])+")"};this.identity()};SQR.Matrix33=function(){this.data=new Float32Array(9);this.identity=function(){var a=this.data;a[0]=1;a[3]=0;a[6]=0;a[1]=0;a[4]=1;a[7]=0;a[2]=0;a[5]=0;a[8]=1;return this};this.transformVector=function(a,c){var b=this.data,d=a.x,e=a.y,f=a.z;c=c||a;c.x=b[0]*d+b[3]*e+b[6]*f;c.y=b[1]*d+b[4]*e+b[7]*f;c.z=b[2]*d+b[5]*e+b[8]*f;return c};this.determinant=function(){var a=this.data;return a[0]*(a[4]*a[8]-a[7]*a[5])+a[3]*(a[7]*a[2]-a[1]*a[8])+a[6]*(a[1]*a[5]-a[4]*a[2])};this.inverse=function(a){var c=this.data;
a=a||this.data;var b=c[0],d=c[1],e=c[2],f=c[3],g=c[4],h=c[5],i=c[6],j=c[7],k=c[8],n=k*g-h*j,l=-k*f+h*i,m=j*f-g*i;c=b*n+d*l+e*m;if(!c)return console.warn("Attempt to inverse a singular matrix33. ",this.data),a;c=1/c;a[0]=n*c;a[1]=(-k*d+e*j)*c;a[2]=(h*d-e*g)*c;a[3]=l*c;a[4]=(k*b-e*i)*c;a[5]=(-h*b+e*f)*c;a[6]=m*c;a[7]=(-j*b+d*i)*c;a[8]=(g*b-d*f)*c;return a};this.transpose=function(){var a=this.data,c=a[3],b=a[6],d=a[1],e=a[4],f=a[7],g=a[2],h=a[5],i=a[8];a[0]=a[0];a[1]=c;a[2]=b;a[3]=d;a[4]=e;a[5]=f;a[6]=
g;a[7]=h;a[8]=i}};SQR.Matrix44=function(){this.data=new Float32Array(16);this.identity=function(a){a=a||this.data;a[0]=1;a[4]=0;a[8]=0;a[12]=0;a[1]=0;a[5]=1;a[9]=0;a[13]=0;a[2]=0;a[6]=0;a[10]=1;a[14]=0;a[3]=0;a[7]=0;a[11]=0;a[15]=1};this.transformVector=function(a,b){var d=this.data,e=a.x,f=a.y,g=a.z,h=a.w;b=b||a;b.x=d[0]*e+d[4]*f+d[8]*g+d[12]*h;b.y=d[1]*e+d[5]*f+d[9]*g+d[13]*h;b.z=d[2]*e+d[6]*f+d[10]*g+d[14]*h;return b};this.multiply=function(a){var b=this.data,d=a.data||a,e,f,g,h,i,j,k,n,l,m,o,p,s,q,r,u,t,v,w,A,
y,B,C,D,E,x,F,z,G,H;a=b[0];e=b[1];f=b[2];g=b[3];h=b[4];i=b[5];j=b[6];k=b[7];n=b[8];l=b[9];m=b[10];o=b[11];p=b[12];s=b[13];q=b[14];r=b[15];u=d[0];t=d[1];v=d[2];w=d[3];A=d[4];y=d[5];B=d[6];C=d[7];D=d[8];E=d[9];x=d[10];F=d[11];z=d[12];G=d[13];H=d[14];d=d[15];b[0]=a*u+h*t+n*v+p*w;b[1]=e*u+i*t+l*v+s*w;b[2]=f*u+j*t+m*v+q*w;b[3]=g*u+k*t+o*v+r*w;b[4]=a*A+h*y+n*B+p*C;b[5]=e*A+i*y+l*B+s*C;b[6]=f*A+j*y+m*B+q*C;b[7]=g*A+k*y+o*B+r*C;b[8]=a*D+h*E+n*x+p*F;b[9]=e*D+i*E+l*x+s*F;b[10]=f*D+j*E+m*x+q*F;b[11]=g*D+k*E+
o*x+r*F;b[12]=a*z+h*G+n*H+p*d;b[13]=e*z+i*G+l*H+s*d;b[14]=f*z+j*G+m*H+q*d;b[15]=g*z+k*G+o*H+r*d;return this};this.setTQS=function(a,b,d,e,f,g,h,i,j,k,n){var l=n||this.data;this.identity(n);var m=f*f,o=g*g,p=h*h;l[0]=(1-2*o-2*p)*i;l[1]=(2*f*g-2*h*e)*i;l[2]=(2*f*h+2*g*e)*i;l[4]=(2*f*g+2*h*e)*j;l[5]=(1-2*m-2*p)*j;l[6]=(2*g*h-2*f*e)*j;l[8]=(2*f*h-2*g*e)*k;l[9]=(2*g*h+2*f*e)*k;l[10]=(1-2*m-2*o)*k;l[12]=a;l[13]=b;l[14]=d;return n||this};this.setTRS=function(a,b,d,e,f,g,h,i,j,k){var n=k||this.data;this.identity(k);
var l=Math.sin(e);e=Math.cos(e);var m=Math.sin(f);f=Math.cos(f);var o=Math.sin(g);g=Math.cos(g);n[0]=(f*g+m*l*o)*h;n[1]=(-f*o+m*l*g)*h;n[2]=m*e*h;n[4]=o*e*i;n[5]=g*e*i;n[6]=-l*i;n[8]=(-m*g+f*l*o)*j;n[9]=(o*m+f*l*g)*j;n[10]=f*e*j;n[12]=a;n[13]=b;n[14]=d;return k||this};this.setScale=function(a,b,d,e){var f=e||this.data;this.identity(e);f[0]=a;f[5]=b;f[10]=d;return e||this};this.setTranslation=function(a,b,d,e){var f=e||this.data;this.identity(e);f[12]=a;f[13]=b;f[14]=d;return e||this};this.setRotation=
function(a,b,d,e){var f=e||this.data;this.identity(e);var g=Math.sin(a);a=Math.cos(a);var h=Math.sin(b);b=Math.cos(b);var i=Math.sin(d);d=Math.cos(d);f[0]=b*d+h*g*i;f[1]=-b*i+h*g*d;f[2]=h*a;f[4]=i*a;f[5]=d*a;f[6]=-g;f[8]=-h*d+b*g*i;f[9]=i*h+b*g*d;f[10]=b*a;return e||this};this.translate=function(a,b,d){this.setTranslation(a,b,d,SQR.Matrix44.__temp);return this.multiply(SQR.Matrix44.__temp)};this.rotate=function(a,b,d){this.setRotation(a,b,d,SQR.Matrix44.__temp);return this.multiply(SQR.Matrix44.__temp)};
this.scale=function(a,b,d){this.setScale(a,b,d,SQR.Matrix44.__temp);return this.multiply(SQR.Matrix44.__temp)};this.copyTo=function(a){for(var b=this.data,d=a.data||a,e=0;e<16;e++)d[e]=b[e];return a};this.copyRotationTo=function(a){var b=this.data,d=a.data||a;d[0]=b[0];d[1]=b[1];d[2]=b[2];d[3]=b[4];d[4]=b[5];d[5]=b[6];d[6]=b[8];d[7]=b[9];d[8]=b[10];return a};var a=function(a){return Math.abs(a)<1.0E-6?0:a};this.getAsCSSProperty=function(){var c=this.data;return"matrix3d("+a(c[0])+","+a(c[1])+","+
a(c[2])+","+a(c[3])+","+a(c[4])+","+a(c[5])+","+a(c[6])+","+a(c[7])+","+a(c[8])+","+a(c[9])+","+a(c[10])+","+a(c[11])+","+a(c[12])+","+a(c[13])+","+a(c[14])+","+a(c[15])+")"};this.extractPosition=function(a){var b=this.data;a.set(b[12],b[13],b[14]);return a};this.determinant=function(){var a=this.data;return a[0]*(a[5]*a[10]-a[9]*a[6])+a[4]*(a[9]*a[2]-a[1]*a[10])+a[8]*(a[1]*a[6]-a[5]*a[2])};this.inverse=function(a){var b=this.data,d=a?a.data||a:this.data,e=b[0],f=b[1],g=b[2],h=b[3],i=b[4],j=b[5],
k=b[6],n=b[7],l=b[8],m=b[9],o=b[10],p=b[11],s=b[12],q=b[13],r=b[14];b=b[15];var u=e*j-f*i,t=e*k-g*i,v=e*n-h*i,w=f*k-g*j,A=f*n-h*j,y=g*n-h*k,B=l*q-m*s,C=l*r-o*s,D=l*b-p*s,E=m*r-o*q,x=m*b-p*q,F=o*b-p*r,z=u*F-t*x+v*E+w*D-A*C+y*B;if(!z)return null;z=1/z;d[0]=(j*F-k*x+n*E)*z;d[1]=(g*x-f*F-h*E)*z;d[2]=(q*y-r*A+b*w)*z;d[3]=(o*A-m*y-p*w)*z;d[4]=(k*D-i*F-n*C)*z;d[5]=(e*F-g*D+h*C)*z;d[6]=(r*v-s*y-b*t)*z;d[7]=(l*y-o*v+p*t)*z;d[8]=(i*x-j*D+n*B)*z;d[9]=(f*D-e*x-h*B)*z;d[10]=(s*A-q*v+b*u)*z;d[11]=(m*v-l*A-p*u)*
z;d[12]=(j*C-i*E-k*B)*z;d[13]=(e*E-f*C+g*B)*z;d[14]=(q*t-s*w-r*u)*z;d[15]=(l*w-m*t+o*u)*z;return a};this.inverseMat3=function(a){var b=this.data,d=a.data,e=this.determinant();if(Math.abs(e)<1.0E-4)return console.warn("Attempt to inverse a singular matrix44. ",this.data),console.trace(),a;var f=b[0],g=b[4],h=b[8],i=b[1],j=b[5],k=b[9],n=b[2],l=b[6];b=b[10];e=1/e;d[0]=(j*b-k*l)*e;d[1]=(h*l-g*b)*e;d[2]=(g*k-h*j)*e;d[3]=(k*n-i*b)*e;d[4]=(f*b-h*n)*e;d[5]=(h*i-f*k)*e;d[6]=(i*l-j*n)*e;d[7]=(g*n-f*l)*e;d[8]=
(f*j-g*i)*e;return a};this.transpose=function(a){var b=this.data;a=a?a.data||a:this.data;var d=b[4],e=b[8],f=b[1],g=b[5],h=b[9],i=b[2],j=b[6],k=b[10];a[0]=b[0];a[1]=d;a[2]=e;a[4]=f;a[5]=g;a[6]=h;a[8]=i;a[9]=j;a[10]=k};this.lookAt=function(a,b){var d=this.data,e=SQR.Matrix44.__tv1,f=SQR.Matrix44.__tv2,g=SQR.Matrix44.__tv3;g.set(d[12],d[13],d[14]);g.sub(g,a).norm();if(g.magsq()===0)g.z=1;e.cross(b,g).norm();e.magsq()===0&&(g.x+=1.0E-4,e.cross(b,g).norm());f.cross(g,e);d[0]=e.x;d[4]=f.x;d[8]=g.x;d[1]=
e.y;d[5]=f.y;d[9]=g.y;d[2]=e.z;d[6]=f.z;d[10]=g.z;return this};this.identity()};SQR.Noise={random3_seed:1};SQR.Noise.isPrime=function(a){for(var c=2;c<=a-1;c++)if(a%c==0)return!1;return!0};SQR.Noise.random1=function(a){a^=a<<13;return 1-(a*(a*a*15731+789221)+1376312589&2147483647)/1073741824};SQR.Noise.random2=function(a){a^=a<<13;return(a*16807+16807)%255};SQR.Noise.random3=function(){SQR.Noise.random3_seed=SQR.Noise.random3_seed*16807%2147483647;return SQR.Noise.random3_seed/2147483647};SQR.ImprovedNoise=function(){function a(a){return a*a*a*(a*(a*6-15)+10)}function c(a,b,c){return b+a*(c-b)}function b(a,b,c,d){a&=15;var e=a<8?b:c;b=a<4?c:a==12||a==14?b:d;return((a&1)==0?e:-e)+((a&2)==0?b:-b)}for(var d=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,
211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,
181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],e=0;e<256;e++)d[256+e]=d[e];return{noise:function(e,g,h){var i=~~e,j=~~g,k=~~h,n=i&255,l=j&255,m=k&255;e-=i;g-=j;h-=k;i=e-1;j=g-1;k=h-1;var o=a(e),p=a(g),s=a(h),q=d[n]+l,r=d[q]+m;q=d[q+1]+m;l=d[n+1]+l;n=d[l]+m;m=d[l+1]+m;return c(s,c(p,c(o,b(d[r],e,g,h),b(d[n],i,g,h)),c(o,b(d[q],e,j,h),b(d[m],i,j,h))),c(p,c(o,b(d[r+1],e,g,k),b(d[n+1],i,g,h-1)),c(o,b(d[q+1],e,j,k),b(d[m+
1],i,j,k))))}}};SQR.ProjectionMatrix=function(){typeof Float32Array=="undefined"&&(Float32Array=Array);this.data=new Float32Array(16);this.copyTo=function(a){for(var c=this.data,b=a.data||a,d=0;d<16;d++)b[d]=c[d];return a};this.identity()};SQR.ProjectionMatrix.prototype.identity=function(){var a=this.data;a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1};
SQR.ProjectionMatrix.prototype.screenPixels2d=function(){this.orthographic(0,window.innerWidth,0,window.innerHeight,0,1E3)};SQR.ProjectionMatrix.prototype.orthographic=function(a,c,b,d,e,f){var g=this.data,h=c-a,i=b-d,j=f-e;g[0]=2/h;g[4]=0;g[8]=0;g[12]=-((c+a)/h);g[1]=0;g[5]=2/i;g[9]=0;g[13]=-((b+d)/i);g[2]=0;g[6]=0;g[10]=-2/j;g[14]=-((f+e)/j);g[3]=0;g[7]=0;g[11]=0;g[15]=1};
SQR.ProjectionMatrix.prototype.perspective=function(a,c,b,d){this.near=b;this.far=d;var e=this.data;a=b*Math.tan(a*Math.PI/360);var f=d-b;e[0]=b/(a*c);e[4]=0;e[8]=0;e[12]=0;e[1]=0;e[5]=b/a;e[9]=0;e[13]=0;e[2]=0;e[6]=0;e[10]=-(d+b)/f;e[14]=-(2*d*b)/f;e[3]=0;e[7]=0;e[11]=-1;e[15]=0};SQR.ProjectionMatrix.prototype.transformVector=function(a,c){var b=a.x,d=a.y,e=a.z,f=a.w,g=this.data;c=c||a;c.x=g[0]*b+g[4]*d+g[8]*e+g[12]*f;c.y=g[1]*b+g[5]*d+g[9]*e+g[13]*f;c.z=g[2]*b+g[6]*d+g[10]*e+g[14]*f;return c};
SQR.ProjectionMatrix.prototype.inverse=function(a){var c=this.data;a=a||this.data;var b=c[0],d=c[1],e=c[2],f=c[3],g=c[4],h=c[5],i=c[6],j=c[7],k=c[8],n=c[9],l=c[10],m=c[11],o=c[12],p=c[13],s=c[14];c=c[15];var q=b*h-d*g,r=b*i-e*g,u=b*j-f*g,t=d*i-e*h,v=d*j-f*h,w=e*j-f*i,A=k*p-n*o,y=k*s-l*o,B=k*c-m*o,C=n*s-l*p,D=n*c-m*p,E=l*c-m*s,x=q*E-r*D+u*C+t*B-v*y+w*A;if(!x)return null;x=1/x;a[0]=(h*E-i*D+j*C)*x;a[1]=(-d*E+e*D-f*C)*x;a[2]=(p*w-s*v+c*t)*x;a[3]=(-n*w+l*v-m*t)*x;a[4]=(-g*E+i*B-j*y)*x;a[5]=(b*E-e*B+f*
y)*x;a[6]=(-o*w+s*u-c*r)*x;a[7]=(k*w-l*u+m*r)*x;a[8]=(g*D-h*B+j*A)*x;a[9]=(-b*D+d*B-f*A)*x;a[10]=(o*v-p*u+c*q)*x;a[11]=(-k*v+n*u-m*q)*x;a[12]=(-g*C+h*y-i*A)*x;a[13]=(b*C-d*y+e*A)*x;a[14]=(-o*t+p*r-s*q)*x;a[15]=(k*t-n*r+l*q)*x;return a};SQR.QuadraticBezier=function(a,c,b,d){this.p0=a;this.c0=c;this.c1=b;this.p1=d;var e,f=SQR.Interpolation.bezierPosition,g=SQR.Interpolation.bezierVelocity;this.velocityAt=function(a,b){e=e||this.p0.clone().set();b=b||e;b.x=g(a,this.p0.x,this.c0.x,this.c1.x,this.p1.x);b.y=g(a,this.p0.y,this.c0.y,this.c1.y,this.p1.y);if(b.z&&this.p0.z)b.z=g(a,this.p0.z,this.c0.z,this.c1.z,this.p1.z);return b};this.valueAt=function(a,b){e=e||this.p0.clone().set();b=b||e;b.x=f(a,this.p0.x,this.c0.x,this.c1.x,this.p1.x);
b.y=f(a,this.p0.y,this.c0.y,this.c1.y,this.p1.y);if(b.z!=null&&this.p0.z!=null)b.z=f(a,this.p0.z,this.c0.z,this.c1.z,this.p1.z);return b}};SQR.Quaternion=function(a,c,b,d){this.set(a,c,b,d)};SQR.Quaternion.prototype.set=function(a,c,b,d){this.w=a||1;this.x=c||0;this.y=b||0;this.z=d||0};SQR.Quaternion.prototype.copyFrom=function(a){this.w=a.w;this.x=a.x;this.y=a.y;this.z=a.z};SQR.Quaternion.prototype.identity=function(){this.set()};SQR.Quaternion.prototype.mul=function(a,c){c=c||this;c.set(c.w*a.w-c.x*a.x-c.y*a.y-c.z*a.z,c.w*a.x+c.x*a.w+c.y*a.z-c.z*a.y,c.w*a.y-c.x*a.z+c.y*a.w+c.z*a.x,c.w*a.z+c.x*a.y-c.y*a.x+c.z*a.w);c.normalize();return c};
SQR.Quaternion.prototype.lookAt=function(a,c){var b=SQR.Quaternion.__tv1,d=SQR.Quaternion.__tv2,e=SQR.Quaternion.__tv3;a.copyTo(b);c.copyTo(e);b.norm();if(b.z==-1)b.x=1.0E-4,b.norm();d.cross(e,b);e.cross(b,d);this.w=Math.sqrt(1+d.x+e.y+b.z)*0.5;var f=4*this.w;this.x=(b.y-e.z)/f;this.y=(d.z-b.x)/f;this.z=(e.x-d.y)/f;this.normalize();return this};SQR.Quaternion.prototype.fromAngleAxis=function(a,c,b,d){var e=Math.sin(a/2);this.x=c*e;this.y=b*e;this.z=d*e;this.w=Math.cos(a/2)};
SQR.Quaternion.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)};SQR.Quaternion.prototype.normalize=function(){var a=this.mag();this.x/=a;this.y/=a;this.z/=a;this.w/=a};SQR.Quaternion.prototype.toMatrix=function(){throw"SQR.Quaternion.toMatrix() is not implemented. Check SQR.Matrix44.TQS()";};
SQR.Quaternion.slerp=function(a,c,b,d){d=d||new SQR.Quaternion;var e=a.w*c.w+a.x*c.x+a.y*c.y+a.z*c.z,f=Math.acos(e),g=Math.sqrt(1-e*e),h=Math.sin((1-b)*f)/g;b=Math.sin(b*f)/g;Math.abs(e)>=1?(h=1,b=0):Math.abs(g)<0.0010&&(b=h=0.5);d.w=a.w*h+c.w*b;d.x=a.x*h+c.x*b;d.y=a.y*h+c.y*b;d.z=a.z*h+c.z*b;return d};SQR.Spline=function(a,c,b,d){var e=this;this.rawPoints=[];this.controlPoints=[];this.length=0;this.samplingFreq=3E3;var f=1,g=4,h=!1;this.rawPoints.push(a,c,b,d);this.controlPoints.push(a,c,b,d);var i=a.clone().set(),j=function(b,c){return a.clone().set().sub(c,b).mul(0.5).appendVec(b)},k=function(a,b,c){a=Math.max(a,0);a=Math.min(a,1);var d,g=e.controlPoints;d=Math.floor(a*f);a=a*f-d;d==g.length/4&&(d=Math.max(0,d-1),a=1);d*=4;b=b||i;b.x=c(a,g[d+0].x,g[d+1].x,g[d+2].x,g[d+3].x);b.y=c(a,g[d+0].y,
g[d+1].y,g[d+2].y,g[d+3].y);b.z=c(a,g[d+0].z,g[d+1].z,g[d+2].z,g[d+3].z);return b};this.valueAt=function(a,b){return k(a,b,SQR.Interpolation.bezierPosition)};this.velocityAt=function(a,b){return k(a,b,SQR.Interpolation.bezierVelocity)};this.recalculateLength=function(b){b=b||this.samplingFreq;for(var c=0,d=a.clone().set(),e=0;e<=b;e++){var f=this.valueAt(e/b);e>0&&(c+=d.sub(f,d).mag());d.copyFrom(f)}this.length=c};this.findTAtDistance=function(b,c,d){d=d||1/this.samplingFreq;for(var e=this.valueAt(b).clone(),
f=0,g=a.clone().set(),h=0;f<c&&h<this.samplingFreq;){b+=d;b=Math.min(b,1);var j=this.valueAt(b);f+=g.sub(e,j).mag();e.copyFrom(j);h++}return b};this.add=function(a,b){this.rawPoints.push(a,b);g=this.rawPoints.length;this.calculateControlPoints();return this};this.closePath=function(){h=!0;this.calculateControlPoints();return this};this.calculateControlPoints=function(){if(g<4||g%2==1)throw"Spline is corrupt - illegal number of points (should be an even number and >= 4)";this.controlPoints=[];f=1;
for(var a=0;a<g;a++){var b=this.rawPoints[a];if(a<3)if(h&&a==0){var c=this.rawPoints[a+1];c=j(c,b);this.controlPoints.push(c)}else this.controlPoints.push(b);else a>=3&&a%2==0?this.controlPoints.push(b):a>=3&&a%2==1&&a==g-1&&!h?this.controlPoints.push(b):a>=3&&a%2==1&&a<g-1&&(c=this.rawPoints[a-1],c=j(b,c),this.controlPoints.push(c,c,b),f++)}if(h){a=this.rawPoints[this.rawPoints.length-1];b=this.rawPoints[0];var d=this.rawPoints[1];c=j(a,this.rawPoints[this.rawPoints.length-2]);d=j(b,d);this.controlPoints.push(c,
c,a,b,d);f++}}};SQR.Spring=function(a){this.anchor=a||new SQR.V2;this.location=this.anchor.clone();this.acceleration=this.anchor.clone();this.velocity=this.anchor.clone();this.friction=0.85;this.k=0.1;var c=0;this.update=function(){this.acceleration.sub(this.location,this.anchor);c=this.acceleration.mag();this.acceleration.norm().mul(-this.k*c);this.velocity.add(this.velocity,this.acceleration);this.velocity.mul(this.friction);this.location.add(this.location,this.velocity)}};SQR.V2=function(a,c){this.x=a||0;this.y=c||0};SQR.V2.prototype.set=function(a,c){this.x=a||0;this.y=c||0;return this};SQR.V2.prototype.copyTo=function(a){a.x=this.x;a.y=this.y};SQR.V2.prototype.copyFrom=function(a){this.x=a.x;this.y=a.y;return this};SQR.V2.prototype.add=function(a,c){this.x=a.x+c.x;this.y=a.y+c.y;return this};SQR.V2.prototype.sub=function(a,c){this.x=a.x-c.x;this.y=a.y-c.y;return this};SQR.V2.prototype.neg=function(){this.x*=-1;this.y*=-1;return this};
SQR.V2.prototype.appendVec=function(a){if(!a)return this;this.x+=a.x;this.y+=a.y;return this};SQR.V2.prototype.mul=function(a,c){c=c||this;c.x=this.x*a;c.y=this.y*a;return c};SQR.V2.prototype.magsq=function(){return this.x*this.x+this.y*this.y};SQR.V2.prototype.mag=function(){return Math.sqrt(this.magsq())};SQR.V2.prototype.norm=function(){var a=this.mag();if(a==0)return this;this.x/=a;this.y/=a;return this};SQR.V2.prototype.perpendicular=function(){var a=this.x;this.x=-this.y;this.y=a;return this};
SQR.V2.prototype.isZero=function(){return this.x==0&&this.y==0};SQR.V2.random=function(){return new SQR.V2(Math.random()*2-1,Math.random()*2-1)};SQR.V2.prototype.setAngleRadius=function(a,c){this.x=Math.cos(a)*c;this.y=Math.sin(a)*c;return this};SQR.V2.prototype.append=function(a,c){this.x+=a;this.y+=c;return this};SQR.V2.prototype.addAngleRadius=function(a,c){this.x+=Math.cos(a)*c;this.y+=Math.sin(a)*c;return this};SQR.V2.prototype.clone=function(){return new SQR.V2(this.x,this.y)};
SQR.V2.prototype.appendToArray=function(a){a.push(this.x,this.y)};SQR.V2.dot=function(a,c){return a.x*c.x+a.y*c.y};SQR.V2.distance=function(a,c){return Math.sqrt((c.x-a.x)*(c.x-a.x)+(c.y-a.y)*(c.y-a.y))};SQR.V2.distanceSqrt=function(a,c){return(c.x-a.x)*(c.x-a.x)+(c.y-a.y)*(c.y-a.y)};SQR.V3=function(a,c,b,d){this.x=a||0;this.y=c||0;this.z=b||0;this.w=d||1;this.array=new Float32Array(3)};SQR.V3.prototype.set=function(a,c,b,d){this.x=a||0;this.y=c||0;this.z=b||0;this.w=d||1;return this};SQR.V3.prototype.append=function(a,c,b,d){this.x+=a||0;this.y+=c||0;this.z+=b||0;this.w+=d||0;return this};SQR.V3.prototype.appendVec=function(a){if(!a)return this;this.x+=a.x;this.y+=a.y;this.z+=a.z;this.w+=a.w;return this};
SQR.V3.prototype.copyTo=function(a){a.x=this.x;a.y=this.y;a.z=this.z;a.w=this.w;return a};SQR.V3.prototype.copyFrom=function(a){this.x=a.x;this.y=a.y;this.z=a.z;this.w=a.w;return this};SQR.V3.prototype.clone=function(){return new SQR.V3(this.x,this.y,this.z)};SQR.V3.prototype.magsq=function(){return this.x*this.x+this.y*this.y+this.z*this.z};SQR.V3.prototype.mag=function(){return Math.sqrt(this.magsq())};SQR.V3.prototype.isZero=function(){return this.x==0&&this.y==0&&this.z==0};
SQR.V3.prototype.mul=function(a){this.x*=a;this.y*=a;this.z*=a;return this};SQR.V3.prototype.neg=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};SQR.V3.prototype.norm=function(){var a=1/this.mag();this.set(this.x*a,this.y*a,this.z*a);return this};SQR.V3.prototype.add=function(a,c){this.x=a.x+c.x;this.y=a.y+c.y;this.z=a.z+c.z;return this};SQR.V3.prototype.sub=function(a,c){this.x=a.x-c.x;this.y=a.y-c.y;this.z=a.z-c.z;return this};
SQR.V3.prototype.random=function(){this.x=Math.random()*2-1;this.y=Math.random()*2-1;this.z=Math.random()*2-1;return this};SQR.V3.dot=function(a,c){return a.x*c.x+a.y*c.y+a.z*c.z};SQR.V3.prototype.cross=function(a,c){this.set(a.y*c.z-a.z*c.y,a.z*c.x-a.x*c.z,a.x*c.y-a.y*c.x,this.w);return this};SQR.V3.prototype.toUniform=function(){var a=this.array;a[0]=this.x;a[1]=this.y;a[2]=this.z;return a};SQR.V3.prototype.appendToArray=function(a){a.push(this.x,this.y,this.z)};SQR.V3.up=new SQR.V3(0,1,0);
SQR.V3.forward=new SQR.V3(0,0,1);SQR.VectorUtil={mouseToUnitSphereVector:function(a,c,b,d){b=b||0.5;d=d||new SQR.V3;a/=b;c/=b;b=a*a+c*c;b>=1?d.set(a,c,0):d.set(a,c,Math.sqrt(1-b));d.norm();return d}};SQR.Quaternion.__tv1=new SQR.V3;SQR.Quaternion.__tv2=new SQR.V3;SQR.Quaternion.__tv3=new SQR.V3;SQR.Matrix2D.__temp=new Float32Array(9);SQR.Matrix33.__temp=new Float32Array(9);SQR.Matrix44.__temp=new Float32Array(16);SQR.Matrix44.__tv1=new SQR.V3;SQR.Matrix44.__tv2=new SQR.V3;SQR.Matrix44.__tv3=new SQR.V3;SQR.VectorUtil.__tv1=new SQR.V3;
SQR.VectorUtil.__tv2=new SQR.V3;SQR.VectorUtil.__tv3=new SQR.V3;SQR.CSSCollider=function(a,c){function b(a,b,c,d){o.transformVector(a,b);b.x=b.x/b.z*c+c;b.y=b.y/b.z*d+d}var d=a*0.5,e=c*0.5,f=new SQR.V3(-d,e,0),g=new SQR.V3(d,e,0),h=new SQR.V3(d,-e,0),i=new SQR.V3(-d,-e,0),j=new SQR.V3,k=new SQR.V3,n=new SQR.V3,l=new SQR.V3,m=new SQR.V2,o=new SQR.Matrix44;this.project=function(a,c){c.projection.copyTo(o);o.multiply(a.viewMatrix);b(f,j,c.centerX,c.centerY);b(g,k,c.centerX,c.centerY);b(h,n,c.centerX,c.centerY);b(i,l,c.centerX,c.centerY)};this.intersects=function(a,
b){m.set(a,b);var c=s(m,j,k,n),d=s(m,j,n,l);return c||d};var p=function(a,b,c){return(a.x-c.x)*(b.y-c.y)-(b.x-c.x)*(a.y-c.y)},s=function(a,b,c,d){var e=p(a,b,c)<0;c=p(a,c,d)<0;a=p(a,d,b)<0;return e==c&&c==a}};SQR.Particle=function(a){this.position=a=a||new SQR.V2;this.velocity=a.clone().set();this.acceleration=a.clone().set();this.angularAcceleration=this.angularVelocity=0;this.mass=1;this.friction=2;this.bounciness=1;var c=a.clone().set(),b=a.clone().set();this.addForce=function(a){c.copyFrom(a);c.mul(1/this.mass);this.acceleration.appendVec(c)};this.update=function(a){b.copyFrom(this.velocity);b.norm();b.mul(-this.friction);this.addForce(b);this.acceleration.mul(a||1);this.velocity.appendVec(this.acceleration);
this.position.appendVec(this.velocity);this.acceleration.set()}};SQR.DOMElement2D=function(a){this.isDom2d=!0;this.element=a;var c=!1,b=null,d=new SQR.Matrix2D,e=new SQR.Matrix44,f=new SQR.V3(0,0,0);this.appendToDom=function(a){c&&a==b||(b=a,b.appendChild(this.element),c=!0)};this.removeFromDom=function(){c&&(b.removeChild(this.element),c=!1)};this.setBackfaceVisibility=function(){};this.draw=function(b,c){c.projection.copyTo(e);e.multiply(b.viewMatrix);var i=f.set(0,0,0);e.transformVector(i);i.x=i.x/i.z*c.centerX;i.y=i.y/i.z*c.centerY;var j=1/(i.z/c.cssDistance);
d.setTRS(i.x,i.y,b.rotation.z,j,j);j=(SQR.supportsCss3d?SQR.DOMUtil.translate3dCss(0,0,0):"")+d.getAsCSSProperty(!1);a.style.zIndex=c.depth;a.style.transform=j;a.style["-webkit-transform"]=j;a.style["-moz-transform"]=j;a.style["-o-transform"]=j;a.style["-ms-transform"]=j;a.style.display=i.z<=0?"none":"block"}};SQR.DOMElement3D=function(a){this.isDom3d=!0;this.element=a;var c=!1,b=null;this.setBackfaceVisibility=function(b){b=b?"visible":"hidden";a.style["backface-visibility"]=b;a.style["-webkit-backface-visibility"]=b;a.style["-moz-backface-visibility"]=b;a.style["-ms-backface-visibility"]=b;a.style["-o-backface-visibility"]=b};this.appendToDom=function(a){c&&a==b||(b=a,b.appendChild(this.element),c=!0)};this.removeFromDom=function(){c&&(b.removeChild(this.element),c=!1)};this.draw=function(b,c){var f=
SQR.DOMUtil.translate3dCss(0,0,c.cssDistance),g="perspective("+c.cssDistance+"px)";f=f+" "+b.viewMatrix.getAsCSSProperty();a.style.transform=f;a.style["-webkit-transform"]=f;a.style["-moz-transform"]=f;a.style["-ms-transform"]=g+f;a.style["-o-transform"]=g+f}};SQR.Point=function(a){var c=new SQR.V3,b=new SQR.Matrix44;this.draw=function(d,e){var f=e.context,g=d.geometry;e.projection.copyTo(b);b.multiply(d.viewMatrix);for(var h=0;h<g.vertices.length;h++)if(g.vertices[h].copyTo(c),b.transformVector(c),!(c.z<0))c.x=c.x/c.z*e.centerX+e.centerX-a,c.y=c.y/c.z*e.centerY+e.centerY-a,f.drawImage(g.particleTextures[h],c.x,c.y)}};SQR.Polygon=function(a){var c=new SQR.Matrix44,b=new SQR.V3;this.culling=!0;this.wireframe=this.useLight=!1;this.lightIntensity=function(a){return a};this.calculateDepth=function(){var a=SQR.Quaternion.__tv1;a.set(0,0,0).add(this.sa,this.sb).add(a,this.sc).mul(1/3);this.depth=a.z};var d=function(a,b,c,d,e){var k=a.vertices[b],n=a.screenVertices[b]||k.clone();n?n.copyFrom(k):n=k.clone();c.transformVector(n);n.x=n.x/n.z*d+d;n.y=e*2-(n.y/n.z*e+e);a.screenVertices[b]=n},e=function(a,b,c,e){if(!a.screenVertices)a.screenVertices=
[];var j=a.vertices.length;d(a,0,b,c,e);d(a,1,b,c,e);d(a,2,b,c,e);j>3&&d(a,3,b,c,e);b=a.screenVertices[0].z;b+=a.screenVertices[1].z;b+=a.screenVertices[2].z;j>3&&(b+=a.screenVertices[3].z);a.depth=b/j};this.draw=function(d,g){var h=g.context,i=d.geometry;g.projection.copyTo(c);c.multiply(d.viewMatrix);var j,k,n=i.faces.length;for(j=0;j<n;j++)k=i.faces[j],e(k,c,g.centerX,g.centerY);i.faces.sort(function(a,b){var c=a.depth,d=b.depth;if(c<d)return 1;if(c>d)return-1;return 0});b.copyFrom(g.camera.forward);
for(j=0;j<n;j++){k=i.faces[j];k.calculateNormal();d.normalMatrix.transformVector(k.normal);var l=Math.max(0,SQR.V3.dot(k.normal,b));if(!(l<0&&this.culling)){var m=Math.max(0,SQR.V3.dot(k.normal,g.lightDirection)),o=a;m=SQR.Color.hsl(o.hue,o.saturation,o.lightness*this.lightIntensity(m),o.alpha);this.useLight?(h.fillStyle=m,h.strokeStyle=l<0?"#00f":m):(h.fillStyle=o.toHSLString(),h.strokeStyle=l<0?"#00f":o.toHSLString());k=k.screenVertices;h.beginPath();h.moveTo(k[0].x,k[0].y);h.lineTo(k[1].x,k[1].y);
h.lineTo(k[2].x,k[2].y);k.length>3&&h.lineTo(k[3].x,k[3].y);h.closePath();this.wireframe||h.fill();h.stroke()}}}};SQR.Segment=function(a){var c=this;this.culling=!1;var b=new SQR.V3,d=new SQR.V3,e=new SQR.Matrix44,f=new SQR.V3(0,0,1),g=new SQR.V3;this.draw=function(h,i){var j=i.context,k=h.geometry;i.projection.copyTo(e);e.multiply(h.viewMatrix);var n=k.vertices.length;k.continous&&j.beginPath();for(var l=0;l<n;l++)if(!(!k.continous&&l%2==1||k.continous&&!k.closed&&l==n-1)){var m=l==n-1?0:l+1;k.vertices[l].copyTo(b);k.vertices[m].copyTo(d);j.strokeStyle=(k.colors?k.colors[l/2|0]:k.color).toCss();j.lineWidth=
a;m=b;var o=d,p=i.centerX,s=i.centerY;e.transformVector(m);e.transformVector(o);m.z<0||o.z<0?m=!1:(g.sub(m,o).norm(),SQR.V3.dot(g,f)<0&&c.culling?m=!1:(m.x=m.x/m.z*p+p,m.y=m.y/m.z*s+s,o.x=o.x/o.z*p+p,o.y=o.y/o.z*s+s,m=!0));m&&(m=j,o=b,p=d,k.continous?l==0?m.moveTo(o.x,o.y):m.lineTo(o.x,o.y):(m.beginPath(),m.moveTo(o.x,o.y),m.lineTo(p.x,p.y),m.stroke()))}k.continous&&(k.closed&&j.closePath(),j.stroke())}};SQR.WebGL=function(a,c){var b=this,d=new SQR.Matrix44;this.renderMode=a.TRIANGLES;this.usage=a.STATIC_DRAW;this.transparent=!1;this.dstFactor=this.srcFactor=null;this.depthTest=!0;this.u={};var e=function(a,b,c){switch(a){case "uMatrix":return b.globalMatrix.data;case "uProjection":return c.projection.data;case "uViewMatrix":return c.viewMatrix.data;case "uNormalMatrix":return b.normalMatrix.data;case "uConcatMatrix":return d.data;default:return!1}};this.draw=function(f,g){var h=f.geometry,i=g.replacementShader||
c;if(i.isReady()&&h.count){g.projection?g.projection.copyTo(d):d.identity();g.viewMatrix&&d.multiply(g.viewMatrix);f.globalMatrix&&d.multiply(f.globalMatrix);if(SQR.GL.useProgram(i.program)||SQR.GL.isNewGeometry(h)||h.dirty){h.setupBuffers(a,i,b.usage);if(h.elements)i.elementBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,i.elementBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,h.elements,b.usage);h.dirty=!1}for(var j,k,n=0;n<i.numUniforms;n++)j=i.uniforms[n],(k=i.u[j.name]||b.u[j.name]||
e(j.name,f,g))&&i.setUniform(j,k);this.renderMode==a.LINES&&a.lineWidth(this.lineWidth||1);h.elements?a.drawElements(this.renderMode,h.elements.length,a.UNSIGNED_SHORT,0):a.drawArrays(this.renderMode,0,h.count)}}};SQR.CanvasUtil={getPixel:function(a,c,b){c=(b*a.width+c)*4;return[a.data[c+0],a.data[c+1],a.data[c+2],a.data[c+3]]},setPixel:function(a,c,b,d,e,f,g){c=(b*a.width+c)*4;a.data[c+0]=d;a.data[c+1]=e;a.data[c+2]=f;a.data[c+3]=g},getPixelRed:function(a,c,b){return a.data[(b*a.width+c)*4]},getPixelAlpha:function(a,c,b){return a.data[(b*a.width+c)*4+3]},getPixelNormRed:function(a,c,b){return a.data[((b*(a.height-1)|0)*a.width+(c*(a.width-1)|0))*4]},rotateAround:function(a,c,b,d){a.translate(b,d);a.rotate(c);
a.translate(-b,-d)}};SQR.Color=function(){var a=new Float32Array([1,1,1]),c=new Float32Array([1,1,1,1]),b=0,d=0,e=0,f=0,g=1,h=0,i=1;this.rgb=function(a,b,c){a!=null&&a>=0&&this.red(a);b!=null&&b>=0&&this.green(b);c!=null&&c>=0&&this.blue(c);return this};this.grey=function(a){this.rgb(a,a,a);return this};this.hsl=function(a,b,c){f=a;g=b;h=c;this.hslToRgb();return this};this.intRGB=function(a,b,c){this.rgb(a/255,b/255,c/255);return this};this.cssHsl=function(a,b,c){f=a/255;g=b/100;h=c/100;this.hslToRgb();return this};this.hex=
function(a){a=a.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(a,b,c,d){return b+b+c+c+d+d});a=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);this.red(parseInt(a[1],16)/255);this.green(parseInt(a[2],16)/255);this.blue(parseInt(a[3],16)/255);return this};this.red=function(d){if(d==void 0||d==null)return b;b=d;a[0]=b;c[0]=b;return this};this.green=function(b){if(b==void 0||b==null)return d;d=b;a[1]=d;c[1]=d;return this};this.blue=function(b){if(b==void 0||b==null)return e;e=b;a[2]=e;c[2]=
e;return this};this.alpha=function(a){if(a==void 0||a==null)return i;i=a;c[3]=i;return this};this.hue=function(a){if(a==void 0||a==null)return f;f=a;return this};this.saturation=function(a){if(a==void 0||a==null)return g;g=a;return this};this.lightness=function(a){if(a==void 0||a==null)return h;h=a;return this};this.hslToRgb=function(){if(g==0)this.rgb(h,h,h);else{var a=function(a,b,c){c<0&&(c+=1);c>1&&(c-=1);if(c<1/6)return a+(b-a)*6*c;if(c<0.5)return b;if(c<2/3)return a+(b-a)*(2/3-c)*6;return a},
b=h<0.5?h*(1+g):h+g-h*g,c=2*h-b;this.red(a(c,b,f+1/3));this.green(a(c,b,f));this.blue(a(c,b,f-1/3))}return this};this.rgbToHsl=function(){var a=Math.max(b,d,e),c=Math.min(b,d,e);h=(a+c)/2;if(a==c)f=g=0;else{var i=a-c;g=h>0.5?i/(2-a-c):i/(a+c);switch(a){case b:f=(d-e)/i+(d<e?6:0);break;case d:f=(e-b)/i+2;break;case e:f=(b-d)/i+4}f/=6}return this};this.toCss=function(a){var c=parseInt(b*255),f=parseInt(d*255),g=parseInt(e*255);return a?"rgb("+c+","+f+","+g+")":"rgba("+c+","+f+","+g+","+i+")"};this.toHslCss=
function(a){var b=parseInt(f*360),c=parseInt(g*100),d=parseInt(h*100);return a?"rgb("+b+","+c+"%,"+d+"%)":"rgba("+b+","+c+"%,"+d+"%,"+i+")"};this.toHex=function(){var a=parseInt(b*255),c=parseInt(d*255),f=parseInt(e*255);return"#"+(16777216+(a<<16)+(c<<8)+f).toString(16).slice(1)};this.toUniform=function(b){return b==SQR.GL.FLOAT_VEC3?a:c};this.toString=function(){return this.toCss()};this.random=function(a){this.red(Math.random());this.green(Math.random());this.blue(Math.random());a&&this.alpha(Math.random());
return this}};SQR.Cubemap=function(a,c,b){var d=this;this.tex=a.createTexture();var e=6,f={};b||(b={});var g=function(){e--;if(e<=0&&(a.bindTexture(a.TEXTURE_CUBE_MAP,d.tex),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,f.front),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_X,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,f.back),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Y,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,f.up),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,f.down),a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_Z,
0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,f.right),a.texImage2D(a.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,f.left),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.generateMipmap(a.TEXTURE_CUBE_MAP),a.bindTexture(a.TEXTURE_CUBE_MAP,null),b.onLoad))b.onLoad()},h=function(a,
b){typeof b=="string"?(f[a]=new Image,f[a].onload=g,f[a].src=b):b.getContext&&(f[a]=b,g())};c.left?(h("left",c.left),h("right",c.right),h("up",c.up),h("down",c.down),h("back",c.back),h("front",c.front)):(h("left",c),h("right",c),h("up",c),h("down",c),h("back",c),h("front",c))};SQR.DOMUtil={translate3dCss:function(a,c,b){return" translate3d("+a+"px,"+c+"px,"+b+"px)"}};SQR.FrameBuffer=function(a,c,b){this.width=c;this.height=b;this.fbo=a.createFramebuffer();this.texture=a.createTexture();this.depthBuffer=a.createRenderbuffer();a.bindFramebuffer(a.FRAMEBUFFER,this.fbo);a.bindTexture(a.TEXTURE_2D,this.texture);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);a.texImage2D(a.TEXTURE_2D,
0,a.RGBA,this.width,this.height,0,a.RGBA,a.UNSIGNED_BYTE,null);a.bindRenderbuffer(a.RENDERBUFFER,this.depthBuffer);a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,this.width,this.height);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this.texture,0);a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,this.depthBuffer);a.bindTexture(a.TEXTURE_2D,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null)};SQR.GL=function(){var a={},c,b=null,d=null;a.contextString="experimental-webgl";a.POINTS=0;a.LINES=1;a.LINE_LOOP=2;a.LINE_STRIP=3;a.TRIANGLES=4;a.TRIANGLE_STRIP=5;a.TRIANGLE_FAN=6;a.STREAM_DRAW=35040;a.STATIC_DRAW=35044;a.DYNAMIC_DRAW=35048;a.FLOAT_VEC2=35664;a.FLOAT_VEC3=35665;a.FLOAT_VEC4=35666;a.init=function(a){c=a};a.useProgram=function(a,d){if(!d&&b==a)return!1;c.useProgram(a);b=a;return!0};a.isNewGeometry=function(a){var b=a!=d;d=a;return b};return a}();SQR.Interactor=function(){var a=this;this.centerY=this.centerX=this.normY=this.normX=this.absPageY=this.absPageX=this.pageY=this.pageX=0;var c=function(b){a.pageX=b.pageX;a.pageY=b.pageY;a.pageCenterX=b.pageX-window.innerWidth*0.5;a.pageCenterY=b.pageY-window.innerHeight*0.5;a.absPageX=b.clientX;a.absPageY=b.clientY;a.normX=b.pageX/window.innerWidth;a.normY=b.pageY/window.innerHeight;a.centerX=a.normX*2-1;a.centerY=a.normY*2-1};this.destroy=function(){document.removeEventListener("mousemove",c,null)};
document.addEventListener("mousemove",c,null)};SQR.Loader={loadText:function(a,c){var b=new XMLHttpRequest;b.open("GET",a);b.onreadystatechange=function(){b.readyState==4&&c.call(null,b.responseText)};b.send()},loadJSON:function(a,c){SQR.Loader.loadText(a,function(a){c(JSON.parse(a))})},loadImage:function(a,c){var b=new Image;b.onload=c(b);b.src=a},loadShader:function(a,c){SQR.Loader.loadText(a,function(a){var d="",e="",f=!0;a=a.split("\n");for(var g=0;g<a.length;g++)if(a[g].indexOf("//#")>-1)a[g].indexOf("//#fragment")>-1?f=!1:a[g].indexOf("//#vertex")>
-1&&(f=!0);else{var h=a[g];h.indexOf("//")>-1&&(h=h.substring(0,h.indexOf("//")));h.match(/^([\s\t]*)$/)||(f?d+=h+"\n":e+=h+"\n")}c(d,e)})}};SQR.OBJParser=function(){var a={};a.parse=function(a,b){var d=a.split("\n"),e=d.length,f=[],g=[],h;for(h=0;h<e;h++){var i=d[h].split(" ");switch(i[0]){case "v":f.push(new SQR.V3(parseFloat(i[1]),parseFloat(i[2]),parseFloat(i[3])));break;case "f":var j=parseInt(i[1])-1,k=parseInt(i[2])-1;i=parseInt(i[3])-1;g.push(new SQR.Triangle(f[j].clone(),f[i].clone(),f[k].clone()))}}d=[];e=[];for(h=0;h<g.length;h++)g[h].calculateNormal(!0),g[h].toArray(d,e);b.vertices=new Float32Array(d);b.normals=new Float32Array(e)};
return a}();SQR.PostEffect=function(a){var c=engine.createShader();c.load(a);a=(new SQR.Geometry).quickSetup("v2t2");a.data(SQR.Geometry.VERTEX,[-1,1,1,1,1,-1,-1,1,1,-1,-1,-1]);a.data(SQR.Geometry.TEXCOORD,[0,1,1,1,1,0,0,1,1,0,0,0]);var b=new SQR.Transform;b.geometry=a;b.renderer=engine.createRenderer(c);b.setSource=function(a){b.renderer.u.uTexture=a.texture};return b};SQR.RenderRegion=function(a,c,b,d){this.x=a;this.y=window.innerHeight-c-d;this.w=b;this.h=d};SQR.Shader=function(a){var c=this;this.program=null;this.u={};this.compile=function(b,c){var e=a.createShader(a.VERTEX_SHADER);a.shaderSource(e,b);a.compileShader(e);var f=a.createShader(a.FRAGMENT_SHADER);a.shaderSource(f,c);a.compileShader(f);this.program=a.createProgram();a.attachShader(this.program,e);a.attachShader(this.program,f);a.linkProgram(this.program);a.getShaderParameter(e,a.COMPILE_STATUS)||console.error("SHADER COMPILE ERROR",a.getShaderInfoLog(e));a.getShaderParameter(f,a.COMPILE_STATUS)||
console.error("SHADER COMPILE ERROR",a.getShaderInfoLog(f));a.getProgramParameter(this.program,a.LINK_STATUS)||console.error("SHADER LINKING ERROR",a.getProgramInfoLog(this.program))};this.inspect=function(){var b=c.program;c.uniforms=[];c.attributes=[];for(var d=a.getProgramParameter(b,a.ACTIVE_UNIFORMS),e=a.getProgramParameter(b,a.ACTIVE_ATTRIBUTES),f=1,g=0;g<d;g++){var h=a.getActiveUniform(b,g);h.location=a.getUniformLocation(b,h.name);if(h.type==a.SAMPLER_2D)h.texId=f++;c.uniforms.push(h)}for(g=
0;g<e;g++)f=a.getActiveAttrib(b,g),f.location=a.getAttribLocation(b,f.name),c.attributes.push(f);c.numUniforms=d;c.numAttributes=e};this.isReady=function(){return this.program!==null};this.load=function(a,d){c.src=a;SQR.Loader.loadShader(a,function(a,b){c.compile(a,b);c.inspect();d&&d(c.program)})};this.setUniform=function(b,c){var e=c;e.toUniform&&(e=e.toUniform(b.type));switch(b.type){case a.BYTE:a.uniform1i(b.location,e);break;case a.UNSIGNED_BYTE:a.uniform1i(b.location,e);break;case a.SHORT:a.uniform1i(b.location,
e);break;case a.UNSIGNED_SHORT:a.uniform1i(b.location,e);break;case a.INT:a.uniform1i(b.location,e);break;case a.INT_VEC2:a.uniform2iv(b.location,e);break;case a.INT_VEC3:a.uniform3iv(b.location,e);break;case a.INT_VEC4:a.uniform4iv(b.location,e);break;case a.UNSIGNED_INT:a.uniform1i(b.location,e);break;case a.FLOAT:a.uniform1f(b.location,e);break;case a.FLOAT_VEC2:a.uniform2fv(b.location,e);break;case a.FLOAT_VEC3:a.uniform3fv(b.location,e);break;case a.FLOAT_VEC4:a.uniform4fv(b.location,e);break;
case a.BOOL:a.uniform1i(b.location,e);break;case a.BOOL_VEC2:a.uniform2iv(b.location,e);break;case a.BOOL_VEC3:a.uniform3iv(b.location,e);break;case a.BOOL_VEC4:a.uniform4iv(b.location,e);break;case a.FLOAT_MAT2:a.uniformMatrix2fv(b.location,!1,e);break;case a.FLOAT_MAT3:a.uniformMatrix3fv(b.location,!1,e);break;case a.FLOAT_MAT4:a.uniformMatrix4fv(b.location,!1,e);break;case a.SAMPLER_2D:var f=b.location,g=b.texId;g=g||1;a.activeTexture(33984+g);e.update&&e.update();if(e.tex)e=e.tex;a.bindTexture(a.TEXTURE_2D,
e);a.uniform1i(f,g);break;case a.SAMPLER_CUBE:f=b.location;g=(g=b.texId)||1;a.activeTexture(33984+g);a.bindTexture(a.TEXTURE_CUBE_MAP,e.tex);a.uniform1i(f,g);break;default:return"WARNING! Unknown uniform type ( 0x"+b.type.toString(16)+" )"}}};SQR.Shader.busy=!1;SQR.Shader.queue=[];SQR.Stringify=function(){var a={},c,b=function(a){a=a.toPrecision(3);a=Math.abs(a)<1.0E-6?0:a;if(a==0)return" 0.000";return a>0?" "+a:a},d=function(a){var b=Math.abs(c[a])>1.0E-4?c[a]:0;b=b.toPrecision(3);b=Math.abs(b)<1.0E-6?0:b;if(b==0)return a+"/0.000";return a+"/"+b};a.v2=function(a){return b(a.x)+" | "+b(a.y)};a.v3=function(a){return b(a.x)+" | "+b(a.y)+" | "+b(a.z)};a.q=function(a){return d(a.w)+" || "+d(a.x)+" | "+d(a.y)+" | "+d(a.z)};a.m33=function(a){c=a.data||a;return d(0)+"\t|\t"+d(3)+
"\t|\t"+d(6)+"\n"+d(1)+"\t|\t"+d(4)+"\t|\t"+d(7)+"\n"+d(2)+"\t|\t"+d(5)+"\t|\t"+d(8)+"\n"};a.m44=function(a){c=a.data||a;return d(0)+"\t|\t"+d(4)+"\t|\t"+d(8)+"\t|\t"+d(12)+"\n"+d(1)+"\t|\t"+d(5)+"\t|\t"+d(9)+"\t|\t"+d(13)+"\n"+d(2)+"\t|\t"+d(6)+"\t|\t"+d(10)+"\t|\t"+d(14)+"\n"+d(3)+"\t|\t"+d(7)+"\t|\t"+d(11)+"\t|\t"+d(15)+"\n"};return a}();SQR.Texture=function(a,c,b){var d=this;this.tex=a.createTexture();this.autoLoad=!0;b||(b={});this.isVideo=this.loaded=!1;this.mipmap=b.mipmap!=null?b.mipmap:!0;this.flip=b.flip!=null?b.flip:!0;this.magFilter=b.magFilter||a.LINEAR;this.minFilter=b.minFilter||b.mipmap?a.LINEAR_MIPMAP_NEAREST:a.LINEAR;this.isPowerOfTwo=function(){return d.src&&d.src.width>0&&d.src.height>0&&(d.src.width&d.src.width-1)==0&&(d.src.height&d.src.height-1)==0};this.update=function(b){if(b||this.loaded&&this.isVideo)try{a.bindTexture(a.TEXTURE_2D,
this.tex),a.texImage2D(a.TEXTURE_2D,0,a.RGB,a.RGB,a.UNSIGNED_BYTE,this.src),a.bindTexture(a.TEXTURE_2D,null)}catch(c){}};var e=function(){if(!d.loaded){var e=d.src&&d.src.width>0&&d.src.height>0&&(d.src.width&d.src.width-1)==0&&(d.src.height&d.src.height-1)==0;if(!d.wrapMode)d.wrapMode=b.wrapMode||e?a.REPEAT:a.CLAMP_TO_EDGE;a.bindTexture(a.TEXTURE_2D,d.tex);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,d.flip);a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,d.src);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,
d.magFilter);d.mipmap&&e&&a.generateMipmap(a.TEXTURE_2D);e?a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,d.minFilter):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);e?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,d.wrapMode),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,d.wrapMode)):(d.wrapMode!=a.CLAMP_TO_EDGE&&console.warn("WARNING! Texture: "+c+" : only CLAMP_TO_EDGE wrapMode is supported for non-power-of-2 textures."),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),
a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE));a.bindTexture(a.TEXTURE_2D,null);if(b.onLoad)b.onLoad();d.loaded=!0}},f=function(a){d.src=new Image;d.src.crossOrigin=b.cors||"";d.src.onload=function(){e()};d.src.src=a},g=function(a){d.isVideo=!0;d.src=document.createElement("video");d.src.src=a;d.src.preload="auto";d.src.loop=!1;var c=function(){d.src.removeEventListener("canplaythrough",c);b.autoPlay&&d.src.play();e()};d.src.addEventListener("ended",function(){if(b.onEnded)b.onEnded(d);
if(b.loop)d.src.currentTime=0,d.src.play()},!1);d.src.addEventListener("canplaythrough",c,!1);d.src.load()};if(typeof c=="string"){var h=c.substring(c.lastIndexOf(".")+1).toLowerCase();switch(h){case "jpg":case "png":case "gif":f(c);break;case "mp4":case "webm":case "ogv":g(c,h);break;default:b.image?f(c):b.video?g(c,h):console.log("Texture format not detected from source path and not specifed in params.")}}else if(c.getContext)d.src=c,e();else if(c instanceof HTMLVideoElement){d.isVideo=!0;d.src=
c;var i=function(){d.src.removeEventListener("canplaythrough",i);e()};d.src.addEventListener("canplaythrough",i,!1)}else console.log("Video format not recognized: "+typeof c),console.log(c instanceof HTMLVideoElement)};SQR.Time={};SQR.Time.time=0;SQR.Time.startTime=0;SQR.Time.timeOffset=0;SQR.Time.lastTime=0;SQR.Time.deltaTime=0;SQR.Time.tick=function(){var a=(new Date).getTime();if(SQR.Time.startTime==0)SQR.Time.startTime=a;if(SQR.Time.lastTime!=0)SQR.Time.deltaTime=a-SQR.Time.lastTime;SQR.Time.lastTime=a;SQR.Time.time=(a-SQR.Time.startTime)/1E3;SQR.Time.deltaTime/=1E3};SQR.Time.getTime=function(){SQR.Time.tick();return SQR.Time.deltaTime};SQR.Time.pause=function(){SQR.Time.timeOffset=(new Date).getTime()};
SQR.Time.resume=function(){SQR.Time.startTime+=(new Date).getTime()-SQR.Time.timeOffset;SQR.Time.lastTime=SQR.Time.deltaTime=0};SQR.Time.formatTime=function(a,c){if(!a)a=SQR.Time.time;var b=Math.floor(a%1*100),d=Math.floor(a)%60,e=Math.floor(a/60);b<10&&(b="0"+b);b==100&&(b="00");d<10&&(d="0"+d);e<10&&(e="0"+e);return c?e+":"+d+":"+b:e+":"+d};
